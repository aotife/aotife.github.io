<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.49">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>1 IRF堆叠配置 | chjina Wiki !</title><meta name="description" content="这是我的第一个 VuePress 站点">
    <link rel="modulepreload" href="/assets/app.a54ed9eb.js"><link rel="modulepreload" href="/assets/IRF堆叠.html.8ea39448.js"><link rel="modulepreload" href="/assets/IRF堆叠.html.2251510e.js"><link rel="prefetch" href="/assets/index.html.4047a691.js"><link rel="prefetch" href="/assets/index.html.6e24346f.js"><link rel="prefetch" href="/assets/index.html.00cdf499.js"><link rel="prefetch" href="/assets/Frontmatter.html.9260cbc2.js"><link rel="prefetch" href="/assets/端口镜像.html.c0647737.js"><link rel="prefetch" href="/assets/index.html.8cceeab2.js"><link rel="prefetch" href="/assets/index.html.dae1b352.js"><link rel="prefetch" href="/assets/VCSA6.7无DNS安装.html.9b589572.js"><link rel="prefetch" href="/assets/404.html.265028f6.js"><link rel="prefetch" href="/assets/index.html.c7cd57e3.js"><link rel="prefetch" href="/assets/index.html.4394badb.js"><link rel="prefetch" href="/assets/index.html.eca5437c.js"><link rel="prefetch" href="/assets/Frontmatter.html.b16b5e92.js"><link rel="prefetch" href="/assets/端口镜像.html.6d1a5f6c.js"><link rel="prefetch" href="/assets/index.html.6854536b.js"><link rel="prefetch" href="/assets/index.html.fee04fc7.js"><link rel="prefetch" href="/assets/VCSA6.7无DNS安装.html.79e77228.js"><link rel="prefetch" href="/assets/404.html.cd58576b.js"><link rel="prefetch" href="/assets/404.b8ccafa9.js"><link rel="prefetch" href="/assets/Layout.a1b4472b.js">
    <link rel="stylesheet" href="/assets/style.f4d22aab.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container no-sidebar"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name">chjina Wiki !</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/" class="" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="数通"><span class="title">数通</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="数通"><span class="title">数通</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/CT/H3C" class="router-link-active" aria-label="华三"><!--[--><!--]--> 华三 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/CT/RuiJie" class="" aria-label="锐捷"><!--[--><!--]--> 锐捷 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/CT/HuaWe" class="" aria-label="华为"><!--[--><!--]--> 华为 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/CT/DEll" class="" aria-label="戴尔"><!--[--><!--]--> 戴尔 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="服务器"><span class="title">服务器</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="服务器"><span class="title">服务器</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/IT/Dell" class="" aria-label="戴尔"><!--[--><!--]--> 戴尔 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/IT/HP" class="" aria-label="惠普"><!--[--><!--]--> 惠普 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/IT/Inspur" class="" aria-label="浪潮"><!--[--><!--]--> 浪潮 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="虚拟化"><span class="title">虚拟化</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="虚拟化"><span class="title">虚拟化</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/VT/Vmware" class="" aria-label="Vmware"><!--[--><!--]--> Vmware <!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/" class="" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="数通"><span class="title">数通</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="数通"><span class="title">数通</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/CT/H3C" class="router-link-active" aria-label="华三"><!--[--><!--]--> 华三 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/CT/RuiJie" class="" aria-label="锐捷"><!--[--><!--]--> 锐捷 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/CT/HuaWe" class="" aria-label="华为"><!--[--><!--]--> 华为 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/CT/DEll" class="" aria-label="戴尔"><!--[--><!--]--> 戴尔 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="服务器"><span class="title">服务器</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="服务器"><span class="title">服务器</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/IT/Dell" class="" aria-label="戴尔"><!--[--><!--]--> 戴尔 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/IT/HP" class="" aria-label="惠普"><!--[--><!--]--> 惠普 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/IT/Inspur" class="" aria-label="浪潮"><!--[--><!--]--> 浪潮 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="虚拟化"><span class="title">虚拟化</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="虚拟化"><span class="title">虚拟化</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/VT/Vmware" class="" aria-label="Vmware"><!--[--><!--]--> Vmware <!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><!----><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="_1-irf堆叠配置" tabindex="-1"><a class="header-anchor" href="#_1-irf堆叠配置" aria-hidden="true">#</a> <strong>1</strong> <strong>IRF堆叠配置</strong></h1><h2 id="_1-1-irf简介" tabindex="-1"><a class="header-anchor" href="#_1-1-irf简介" aria-hidden="true">#</a> 1.1 IRF简介</h2><p>IRF（Intelligent Resilient Framework，智能弹性架构）是H3C自主研发的软件虚拟化技术。它的核心思想是将多台设备连接在一起，进行必要的配置后，虚拟化成一台设备。使用这种虚拟化技术可以集合多台设备的硬件资源和软件处理能力，实现多台设备的协同工作、统一管理和不间断维护。</p><p>为了便于描述，这个“虚拟设备”也称为IRF。所以，本文中的IRF有两层意思，一个是指IRF技术，一个是指IRF设备。</p><h3 id="_1-1-1-irf的优点" tabindex="-1"><a class="header-anchor" href="#_1-1-1-irf的优点" aria-hidden="true">#</a> 1.1.1 IRF的优点</h3><p>IRF主要具有以下优点：</p><p>· 简化管理。IRF形成之后，用户通过任意成员设备的任意端口都可以登录IRF系统，对IRF内所有成员设备进行统一管理。</p><p>· 1:N备份。IRF由多台成员设备组成，其中，主设备负责IRF的运行、管理和维护，从设备在作为备份的同时也可以处理业务。一旦主设备故障，系统会迅速自动选举新的主设备，以保证业务不中断，从而实现了设备的1:N备份。</p><p>· 跨成员设备的链路聚合。IRF和上、下层设备之间的物理链路支持聚合功能，并且不同成员设备上的物理链路可以聚合成一个逻辑链路，多条物理链路之间可以互为备份也可以进行负载分担，当某个成员设备离开IRF，其它成员设备上的链路仍能收发报文，从而提高了聚合链路的可靠性。</p><p>· 强大的网络扩展能力。通过增加成员设备，可以轻松自如的扩展IRF的端口数、带宽。因为各成员设备都有CPU，能够独立处理协议报文、进行报文转发，所以IRF还能轻松自如的扩展处理能力。</p><h3 id="_1-1-2-irf的应用" tabindex="-1"><a class="header-anchor" href="#_1-1-2-irf的应用" aria-hidden="true">#</a> 1.1.2 IRF的应用</h3><p>如图1-1所示，主设备和从设备组成IRF，对上、下层设备来说，它们就是一台设备——IRF。</p><p>图1-1 IRF组网应用示意图</p><p><img src="https://typore-img.oss-cn-beijing.aliyuncs.com/Typecho/img/2022/20220519150322.png" alt=""></p><h2 id="_2-irf典型配置举例-bfd-mad检测方式" tabindex="-1"><a class="header-anchor" href="#_2-irf典型配置举例-bfd-mad检测方式" aria-hidden="true">#</a> 2 IRF典型配置举例（BFD MAD检测方式）</h2><h3 id="_1-组网需求" tabindex="-1"><a class="header-anchor" href="#_1-组网需求" aria-hidden="true">#</a> 1. 组网需求</h3><p>由于网络规模迅速扩大，当前中心交换机（Device A）转发能力已经不能满足需求，现需要在保护现有投资的基础上将网络转发能力提高三倍，并要求网络易管理、易维护。</p><h3 id="_2-组网图" tabindex="-1"><a class="header-anchor" href="#_2-组网图" aria-hidden="true">#</a> 2. 组网图</h3><p>图1-15 IRF典型配置组网图（BFD MAD检测方式）</p><p><img src="https://typore-img.oss-cn-beijing.aliyuncs.com/Typecho/img/2022/20220519151529.png" alt="BFD MAD检测方式"></p><h3 id="_3-配置思路" tabindex="-1"><a class="header-anchor" href="#_3-配置思路" aria-hidden="true">#</a> 3. 配置思路</h3><p>· Device A处于局域网的汇聚层，为了将汇聚层的转发能力提高三倍，需要另外增加三台设备Device B、Device C和Device D。</p><p>· 鉴于IRF技术具有管理简便、网络扩展能力强、可靠性高等优点，所以本例使用IRF技术构建网络汇聚层（即在四台设备上配置IRF功能），每台成员设备与上层设备Device E之间均有一条上行链路连接。</p><p>· 为了防止IRF链路故障导致IRF分裂，网络中存在两个配置冲突的IRF，需要启用MAD检测功能。本例中我们采用BFD MAD检测方式来监测IRF的状态，并使用成员设备与上层设备间的专用链路传递BFD MAD报文。</p><h3 id="_4-配置步骤" tabindex="-1"><a class="header-anchor" href="#_4-配置步骤" aria-hidden="true">#</a> 4. 配置步骤</h3><p>注：一个设备有两个IRF端口，1和2。相邻的两个设备的端口不要相同，否则不能形成IRF。</p><p>如：1号设备的irf-port 1/1物理端口只能对应2号设备的 irf-port 2/2物理端口</p><p><img src="https://typore-img.oss-cn-beijing.aliyuncs.com/Typecho/img/2022/20220519151647.png" alt="img"></p><h4 id="_1-配置device-a" tabindex="-1"><a class="header-anchor" href="#_1-配置device-a" aria-hidden="true">#</a> (1) 配置Device A</h4><p># 根据<a href="https://cdn.jsdelivr.net/gh/xyzz-by/imge@main/2021/20220427203415.png" target="_blank" rel="noopener noreferrer">图1-15<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>选定IRF物理端口并关闭这些端口。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;Sysname&gt; system-view
[Sysname] interface range ten-gigabitethernet 1/0/49 to ten-gigabitethernet 1/0/52
[Sysname-if-range] shutdown
[Sysname-if-range] quit
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p># 配置IRF端口1/1，并将它与物理端口Ten-GigabitEthernet1/0/49和Ten-GigabitEthernet1/0/50绑定。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[Sysname] irf-port 1/1
[Sysname-irf-port1/1] port group interface ten-gigabitethernet 1/0/49
[Sysname-irf-port1/1] port group interface ten-gigabitethernet 1/0/50
[Sysname-irf-port1/1] quit
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p># 配置IRF端口1/2，并将它与物理端口Ten-GigabitEthernet1/0/51和Ten-GigabitEthernet1/0/52绑定。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[Sysname] irf-port 1/2
[Sysname-irf-port1/2] port group interface ten-gigabitethernet 1/0/51
[Sysname-irf-port1/2] port group interface ten-gigabitethernet 1/0/52
[Sysname-irf-port1/2] quit
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p># 开启Ten-GigabitEthernet1/0/49～Ten-GigabitEthernet1/0/52端口，并保存配置。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[Sysname] interface range ten-gigabitethernet 1/0/49 to ten-gigabitethernet 1/0/52
[Sysname-if-range] undo shutdown
[Sysname-if-range] quit
[Sysname] save
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p># 激活IRF端口下的配置。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[Sysname] irf-port-configuration active
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_2-配置device-b" tabindex="-1"><a class="header-anchor" href="#_2-配置device-b" aria-hidden="true">#</a> (2) 配置Device B</h4><p># 将Device B的成员编号配置为2，并重启设备使新编号生效。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;Sysname&gt; system-view
[Sysname] irf member 1 renumber 2
Renumbering the member ID may result in configuration change or loss. Continue? [Y/N]:y
[Sysname] quit
&lt;Sysname&gt; reboot
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p># 根据<a href="https://cdn.jsdelivr.net/gh/xyzz-by/imge@main/2021/20220427203415.png" target="_blank" rel="noopener noreferrer">图1-15<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>选定IRF物理端口并进行物理连线。</p><p># 重新登录到设备，关闭选定的所有IRF物理端口。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;Sysname&gt; system-view
[Sysname] interface range ten-gigabitethernet 2/0/49 to ten-gigabitethernet 2/0/52
[Sysname-if-range] shutdown
[Sysname-if-range] quit
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p># 配置IRF端口2/1，并将它与物理端口Ten-GigabitEthernet2/0/49和Ten-GigabitEthernet2/0/50绑定。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[Sysname] irf-port 2/1
[Sysname-irf-port2/1] port group interface ten-gigabitethernet 2/0/49
[Sysname-irf-port2/1] port group interface ten-gigabitethernet 2/0/50
[Sysname-irf-port2/1] quit
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p># 配置IRF端口2/2，并将它与物理端口Ten-GigabitEthernet2/0/51和Ten-GigabitEthernet2/0/52绑定。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[Sysname] irf-port 2/2
[Sysname-irf-port2/2] port group interface ten-gigabitethernet 2/0/51
[Sysname-irf-port2/2] port group interface ten-gigabitethernet 2/0/52
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p># 开启Ten-GigabitEthernet2/0/49～Ten-GigabitEthernet2/0/52端口，并保存配置。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[Sysname] interface range ten-gigabitethernet 2/0/49 to ten-gigabitethernet 2/0/52
[Sysname-if-range] undo shutdown
[Sysname-if-range] quit
[Sysname] save
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p># 激活IRF端口下的配置。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[Sysname] irf-port-configuration active
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>(3) Device A和Device B间将会进行主设备竞选，竞选失败的一方将重启，重启完成后，IRF形成。</p><h4 id="_4-配置device-c" tabindex="-1"><a class="header-anchor" href="#_4-配置device-c" aria-hidden="true">#</a> (4) 配置Device C</h4><p># 将Device C的成员编号配置为3，并重启设备使新编号生效。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;Sysname&gt; system-view
[Sysname] irf member 1 renumber 3
Renumbering the member ID may result in configuration change or loss. Continue? [Y/N]:y
[Sysname] quit
&lt;Sysname&gt; reboot
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p># 根据<a href="https://cdn.jsdelivr.net/gh/xyzz-by/imge@main/2021/20220427203415.png" target="_blank" rel="noopener noreferrer">图1-15<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>选定IRF物理端口并进行物理连线。</p><p># 重新登录到设备，关闭选定的所有IRF物理端口。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;Sysname&gt; system-view
[Sysname] interface range ten-gigabitethernet 3/0/49 to ten-gigabitethernet 3/0/52
[Sysname-if-range] shutdown
[Sysname-if-range] quit
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p># 配置IRF端口3/1，并将它与物理端口Ten-GigabitEthernet3/0/49和Ten-GigabitEthernet3/0/50绑定。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[Sysname] irf-port 3/1
[Sysname-irf-port3/1] port group interface ten-gigabitethernet 3/0/49
[Sysname-irf-port3/1] port group interface ten-gigabitethernet 3/0/50
[Sysname-irf-port3/1] quit
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p># 配置IRF端口3/2，并将它与物理端口Ten-GigabitEthernet3/0/51和Ten-GigabitEthernet3/0/52绑定。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[Sysname] irf-port 3/2
[Sysname-irf-port3/2] port group interface ten-gigabitethernet 3/0/51
[Sysname-irf-port3/2] port group interface ten-gigabitethernet 3/0/52
[Sysname-irf-port3/2] quit
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p># 开启Ten-GigabitEthernet3/0/49～Ten-GigabitEthernet3/0/52端口，并保存配置。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[Sysname] interface range ten-gigabitethernet 3/0/49 to ten-gigabitethernet 3/0/52
[Sysname-if-range] undo shutdown
[Sysname-if-range] quit
[Sysname] save
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p># 激活IRF端口下的配置。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[Sysname] irf-port-configuration active
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>(5) Device C将自动重启，加入Device A和Device B已经形成的IRF。</p><h4 id="_6-配置device-d" tabindex="-1"><a class="header-anchor" href="#_6-配置device-d" aria-hidden="true">#</a> (6) 配置Device D</h4><p># 将Device D的成员编号配置为4，并重启设备使新编号生效。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;Sysname&gt; system-view
[Sysname] irf member 1 renumber 4
Renumbering the member ID may result in configuration change or loss. Continue? [Y/N]:y
[Sysname] quit
&lt;Sysname&gt; reboot
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p># 根据<a href="https://cdn.jsdelivr.net/gh/xyzz-by/imge@main/2021/20220427203415.png" target="_blank" rel="noopener noreferrer">图1-15<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>选定IRF物理端口并进行物理连线。</p><p># 重新登录到设备，关闭选定的所有IRF物理端口。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;Sysname&gt; system-view
[Sysname] interface range ten-gigabitethernet 4/0/49 to ten-gigabitethernet 4/0/52
[Sysname-if-range] shutdown
[Sysname-if-range] quit
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p># 配置IRF端口4/1，并将它与物理端口Ten-GigabitEthernet4/0/49和Ten-GigabitEthernet4/0/50绑定。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[Sysname] irf-port 4/1
[Sysname-irf-port4/1] port group interface ten-gigabitethernet 4/0/49
[Sysname-irf-port4/1] port group interface ten-gigabitethernet 4/0/50
[Sysname-irf-port4/1] quit
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p># 配置IRF端口4/2，并将它与物理端口Ten-GigabitEthernet4/0/51和Ten-GigabitEthernet4/0/52绑定。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[Sysname] irf-port 4/2
[Sysname-irf-port4/2] port group interface ten-gigabitethernet 4/0/51
[Sysname-irf-port4/2] port group interface ten-gigabitethernet 4/0/52
[Sysname-irf-port4/2] quit
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p># 开启Ten-GigabitEthernet4/0/49～Ten-GigabitEthernet4/0/52端口，并保存配置。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[Sysname] interface range ten-gigabitethernet 4/0/49 to ten-gigabitethernet 4/0/52
[Sysname-if-range] undo shutdown
[Sysname-if-range] quit
[Sysname] save
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p># 激活IRF端口下的配置。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[Sysname] irf-port-configuration active
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>(7) Device D将自动重启，加入Device A、Device B和Device C已经形成的IRF。</p><h4 id="_8-配置bfd-mad" tabindex="-1"><a class="header-anchor" href="#_8-配置bfd-mad" aria-hidden="true">#</a> (8) 配置BFD MAD</h4><h5 id="vlan方式" tabindex="-1"><a class="header-anchor" href="#vlan方式" aria-hidden="true">#</a> VLAN方式</h5><p># 创建VLAN 3，并将端口GigabitEthernet1/0/1、GigabitEthernet2/0/1、GigabitEthernet3/0/1和GigabitEthernet4/0/1加入VLAN 3中。 # 此VLAN只能作为BFD MAD检测用，不要用于其他业务。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[Sysname] vlan 3
[Sysname-vlan3] port gigabitethernet 1/0/1 gigabitethernet 2/0/1 gigabitethernet 3/0/1 gigabitethernet 4/0/1
[Sysname-vlan3] quit
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p># 创建VLAN接口3，并配置MAD IP地址。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[Sysname] interface vlan-interface 3
[Sysname-Vlan-interface3] mad bfd enable
[Sysname-Vlan-interface3] mad ip address 192.168.2.1 24 member 1
[Sysname-Vlan-interface3] mad ip address 192.168.2.2 24 member 2
[Sysname-Vlan-interface3] mad ip address 192.168.2.3 24 member 3
[Sysname-Vlan-interface3] mad ip address 192.168.2.4 24 member 4
[Sysname-Vlan-interface3] quit
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p># 因为BFD MAD和生成树功能互斥，所以在GigabitEthernet1/0/1、GigabitEthernet2/0/1、GigabitEthernet3/0/1和GigabitEthernet4/0/1端口上关闭生成树协议。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[Sysname] interface range gigabitethernet 1/0/1 gigabitethernet 2/0/1 gigabitethernet 3/0/1 gigabitethernet 4/0/1
[Sysname-if-range] undo stp enable
[Sysname-if-range] quit
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>(9) 配置中间设备Device E</p><p>Device E作为中间设备来透传BFD MAD报文，协助IRF中的四台成员设备进行多Active检测。</p><p>![注意]如果中间设备是一个IRF系统，则必须通过配置确保其IRF域编号与被检测的IRF系统不同。</p><p># 创建VLAN 3，并将端口GigabitEthernet1/0/1～GigabitEthernet1/0/4加入VLAN 3中，用于转发BFD MAD报文。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;DeviceE&gt; system-view
[DeviceE] vlan 3
[DeviceE-vlan3] port gigabitethernet 1/0/1 to gigabitethernet 1/0/4
[DeviceE-vlan3] quit
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="三层聚合方式" tabindex="-1"><a class="header-anchor" href="#三层聚合方式" aria-hidden="true">#</a> 三层聚合方式</h5><p>举例：两个设备</p><p># 创建三层聚合口</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code> [Sysname]interface Route-Aggregation 1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p># 创建三层聚合接口1，并配置MAD IP地址。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[Sysname] interface Route-Aggregation 1
[Sysname] mad bfd enable
[Sysname] mad ip address 192.168.1.1 255.255.255.252 member 1
[Sysname] mad ip address 192.168.1.2 255.255.255.252 member 2
[Sysname] quit
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p># 将端口GigabitEthernet1/0/1、GigabitEthernet2/0/1加入到三层聚合口内。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[Sysname] interface GigabitEthernet1/0/1
[Sysname] port link-mode route
[Sysname] port link-aggregation group 1
[Sysname] quit
[Sysname] interface GigabitEthernet1/0/2
[Sysname] port link-mode route
[Sysname] port link-aggregation group 1
[Sysname] quit
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="检测验证" tabindex="-1"><a class="header-anchor" href="#检测验证" aria-hidden="true">#</a> 检测验证</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[Sysname]display mad verbose
Multi-active recovery state: No
Excluded ports (user-configured):
Excluded ports (system-configured):
  Ten-GigabitEthernet1/0/49
  Ten-GigabitEthernet1/0/50
  Ten-GigabitEthernet2/0/49
  Ten-GigabitEthernet2/0/50
MAD ARP disabled.
MAD ND disabled.
MAD LACP disabled.
MAD BFD enabled interface: Route-Aggregation1
  MAD status                 : Normal
  Member ID   MAD IP address       Neighbor   MAD status
  1           1.1.1.1/30           2          Normal
  2           1.1.1.2/30           1          Normal
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试拔掉堆叠线，Standby 设备上端口全部Down，说明正常</p><h2 id="其他配置" tabindex="-1"><a class="header-anchor" href="#其他配置" aria-hidden="true">#</a> 其他配置</h2><h3 id="_1-irf显示和维护" tabindex="-1"><a class="header-anchor" href="#_1-irf显示和维护" aria-hidden="true">#</a> 1.IRF显示和维护</h3><table><thead><tr><th>操作</th><th>命令</th></tr></thead><tbody><tr><td>显示IRF中所有成员设备的相关信息</td><td><strong>display irf</strong></td></tr><tr><td>显示IRF的拓扑信息</td><td><strong>display irf topology</strong></td></tr><tr><td>显示IRF链路信息</td><td><strong>display irf link</strong></td></tr><tr><td>显示所有成员设备上重启以后生效的IRF配置</td><td><strong>display irf configuration</strong></td></tr><tr><td>显示MAD配置信息</td><td><strong>display mad</strong> [ <strong>verbose</strong> ]</td></tr></tbody></table><h3 id="_2-配置成员优先级" tabindex="-1"><a class="header-anchor" href="#_2-配置成员优先级" aria-hidden="true">#</a> 2.配置成员优先级</h3><p>在主设备选举过程中，优先级数值大的成员设备将优先被选举成为主设备。</p><p>IRF形成后，也可以通过本配置修改成员优先级，但修改不会触发选举，修改的优先级在下一次选举时生效。</p><h4 id="_2-1-配置步骤" tabindex="-1"><a class="header-anchor" href="#_2-1-配置步骤" aria-hidden="true">#</a> 2.1. 配置步骤</h4><p>(1) 配置IRF中指定成员设备的优先级。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[Sysname] irf member 1 priority 32
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>缺省情况下，设备的成员优先级为1。数值越大优先级越高，最大32。</p><h3 id="_3-irf链路状态变化延迟上报功能" tabindex="-1"><a class="header-anchor" href="#_3-irf链路状态变化延迟上报功能" aria-hidden="true">#</a> 3.IRF链路状态变化延迟上报功能</h3><p>该功能用于避免因端口链路层状态在短时间内频繁改变，导致IRF分裂/合并的频繁发生。</p><h4 id="_3-1-配置限制和指导" tabindex="-1"><a class="header-anchor" href="#_3-1-配置限制和指导" aria-hidden="true">#</a> 3.1. 配置限制和指导</h4><p>下列情况下，建议将IRF链路状态变化延迟上报时间配置为0：</p><p>· 对主备倒换速度和IRF链路切换速度要求较高时</p><p>· 在IRF环境中使用RRPP、BFD或GR功能时</p><p>· 在执行关闭IRF物理端口或重启IRF成员设备的操作之前，请首先将IRF链路状态变化延迟上报时间配置为0，待操作完成后再将其恢复为之前的值</p><h4 id="_3-2-配置步骤" tabindex="-1"><a class="header-anchor" href="#_3-2-配置步骤" aria-hidden="true">#</a> 3.2. 配置步骤</h4><p>配置IRF链路状态变化延迟上报时间。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code> [Sysname] irf link-delay 0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>一般实际环境两台设备直链，建议配置成0秒，默认IRF链路状态变化延迟上报时间为4秒。</p><h3 id="_4-配置保留接口" tabindex="-1"><a class="header-anchor" href="#_4-配置保留接口" aria-hidden="true">#</a> 4.配置保留接口</h3><p>当IRF分裂时，会关闭Recovery状态IRF上除了系统保留接口外的所有业务接口。系统保留接口包括：</p><p>· IRF物理端口， BFD MAD检测接口， 用户配置的保留聚合接口的成员接口</p><p>如果接口有特殊用途需要保持up状态（比如Telnet登录接口等），则用户可以通过命令行将这些接口配置为保留接口。</p><h4 id="_1-配置限制和指导" tabindex="-1"><a class="header-anchor" href="#_1-配置限制和指导" aria-hidden="true">#</a> 1. 配置限制和指导</h4><p>使用VLAN接口进行远程登录时，需要将该VLAN接口及其对应的以太网端口都配置为保留接口。但如果在正常工作状态的IRF中该VLAN接口也处于UP状态，则在网络中会产生IP地址冲突。</p><h4 id="_2-配置步骤" tabindex="-1"><a class="header-anchor" href="#_2-配置步骤" aria-hidden="true">#</a> 2. 配置步骤</h4><p>(1) 配置保留接口，当设备进入Recovery状态时，该接口不会被关闭。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[Sysname] mad exclude interface GigabitEthernet 1/0/1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>缺省情况下，设备进入Recovery状态时会自动关闭本设备上除了系统保留接口以外的所有业务接口。</p><hr><p>引用：</p><p>https://www.h3c.com/cn/d_202108/1434017_30005_0.htm#_Toc78641449</p></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/aotife/aotife.github.io/edit/main/docs/CT/H3C/IRF堆叠.md" rel="noopener noreferrer" target="_blank" aria-label="在GitHub上编辑页面"><!--[--><!--]--> 在GitHub上编辑页面 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">最近更新时间: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">贡献者: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: adsdye@outlook.com">chjinas</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.a54ed9eb.js" defer></script>
  </body>
</html>
